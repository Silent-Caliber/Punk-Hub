local __PELINDA_SERVICE__ = "punk-x-release-key"
local __PELINDA_SILENTMODE__ = true
local __PELINDA_SECURITY_LEVEL__ = 1 
local PUNK_HUB_URL = "https://raw.githubusercontent.com/GBMofo/Punk-Hub/main/The-Forge"

-- [[ HUB EXECUTION ]]
local function LoadHub()
    print("Punk X: Attempting to fetch script...")
    local success, scriptContent = pcall(function()
        return game:HttpGet(PUNK_HUB_URL)
    end)

    if success and scriptContent then
        -- Check if GitHub returned a 404 page text instead of code
        if scriptContent:find("404: Not Found") or scriptContent:find("<!DOCTYPE html>") then
            warn("Punk X: HTTP 404 - GitHub could not find the file 'The-Forge'. Check if the repo is Public.")
            return
        end
        
        local loadFunc, err = loadstring(scriptContent)
        if loadFunc then
            print("Punk X: Success Load!")
            loadFunc()
        else
            warn("Punk X: Script compilation failed: " .. tostring(err))
        end
    else
        warn("Punk X: Failed to reach GitHub. Error: " .. tostring(scriptContent))
    end
end

function ShowKeySystem()
    -- Draggable Function
    local function MakeDraggable(gui)
        local dragging, dragInput, dragStart, startPos
        local function update(input)
            local delta = input.Position - dragStart
            gui.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
        gui.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                dragging = true
                dragStart = input.Position
                startPos = gui.Position
                input.Changed:Connect(function()
                    if input.UserInputState == Enum.UserInputState.End then
                        dragging = false
                    end
                end)
            end
        end)
        gui.InputChanged:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
                dragInput = input
            end
        end)
        game:GetService("UserInputService").InputChanged:Connect(function(input)
            if input == dragInput and dragging then
                update(input)
            end
        end)
    end

    local ScreenGui = Instance.new("ScreenGui")
    local MainFrame = Instance.new("Frame")
    local ImageLabel = Instance.new("ImageLabel")
    local UICorner = Instance.new("UICorner")
    local NamaHub = Instance.new("TextLabel")
    local KeySystemLabel = Instance.new("TextLabel")
    local TextBoxContainer = Instance.new("Frame")
    local UICorner_2 = Instance.new("UICorner")
    local UIStroke = Instance.new("UIStroke")
    local KeyTextBox = Instance.new("TextBox")
    local KunciIcon = Instance.new("ImageLabel")
    local GetKeyContainer = Instance.new("Frame")
    local GetKeyButton = Instance.new("TextButton")
    local RedeemContainer = Instance.new("Frame")
    local RedeemButton = Instance.new("TextButton")

    ScreenGui.Parent = (game:GetService("CoreGui") or game:GetService("Players").LocalPlayer:FindFirstChild("PlayerGui"))
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    ScreenGui.IgnoreGuiInset = true

    MainFrame.Name = "MainFrame"
    MainFrame.Parent = ScreenGui
    MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    MainFrame.Size = UDim2.new(0, 400, 0, 200)
    MakeDraggable(MainFrame)

    ImageLabel.Parent = MainFrame
    ImageLabel.AnchorPoint = Vector2.new(0.5, 0.5)
    ImageLabel.BackgroundTransparency = 1.000
    ImageLabel.Position = UDim2.new(0.5, 0, 0.5, 0)
    ImageLabel.Size = UDim2.new(0, 400, 0, 200)
    ImageLabel.Image = "rbxassetid://8992230677"
    ImageLabel.ImageColor3 = Color3.fromRGB(0, 0, 0)
    ImageLabel.ImageTransparency = 0.6
    ImageLabel.ScaleType = Enum.ScaleType.Slice
    ImageLabel.SliceCenter = Rect.new(99, 99, 99, 99)

    UICorner.CornerRadius = UDim.new(0, 10)
    UICorner.Parent = MainFrame

    NamaHub.Name = "NamaHub"
    NamaHub.Parent = MainFrame
    NamaHub.BackgroundTransparency = 1.000
    NamaHub.Position = UDim2.new(0, 0, 0, 10)
    NamaHub.Size = UDim2.new(1, 0, 0, 30)
    NamaHub.Font = Enum.Font.FredokaOne
    NamaHub.Text = "PUNK X HUB"
    NamaHub.TextColor3 = Color3.fromRGB(255, 255, 255)
    NamaHub.TextSize = 26

    KeySystemLabel.Name = "KeySystemLabel"
    KeySystemLabel.Parent = MainFrame
    KeySystemLabel.BackgroundTransparency = 1.000
    KeySystemLabel.Position = UDim2.new(0, 0, 0.25, 0)
    KeySystemLabel.Size = UDim2.new(1, 0, 0, 20)
    KeySystemLabel.Font = Enum.Font.SourceSansBold
    KeySystemLabel.Text = "LICENSE VERIFICATION"
    KeySystemLabel.TextColor3 = Color3.fromRGB(0, 160, 255)
    KeySystemLabel.TextSize = 16

    TextBoxContainer.Name = "TextBoxContainer"
    TextBoxContainer.Parent = MainFrame
    TextBoxContainer.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    TextBoxContainer.Position = UDim2.new(0.1, 0, 0.45, 0)
    TextBoxContainer.Size = UDim2.new(0.8, 0, 0, 35)
    Instance.new("UICorner", TextBoxContainer).CornerRadius = UDim.new(0, 6)

    KeyTextBox.Name = "KeyTextBox"
    KeyTextBox.Parent = TextBoxContainer
    KeyTextBox.BackgroundTransparency = 1.000
    KeyTextBox.Position = UDim2.new(0.1, 0, 0, 0)
    KeyTextBox.Size = UDim2.new(0.85, 0, 1, 0)
    KeyTextBox.Font = Enum.Font.SourceSans
    KeyTextBox.PlaceholderText = "Input Key..."
    KeyTextBox.Text = ""
    KeyTextBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    KeyTextBox.TextSize = 16
    KeyTextBox.TextXAlignment = Enum.TextXAlignment.Left

    KunciIcon.Name = "KunciIcon"
    KunciIcon.Parent = TextBoxContainer
    KunciIcon.BackgroundTransparency = 1.000
    KunciIcon.Position = UDim2.new(0.02, 0, 0.15, 0)
    KunciIcon.Size = UDim2.new(0, 24, 0, 24)
    KunciIcon.Image = "rbxassetid://10723416652"

    GetKeyContainer.Name = "GetKeyContainer"
    GetKeyContainer.Parent = MainFrame
    GetKeyContainer.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    GetKeyContainer.Position = UDim2.new(0.1, 0, 0.7, 0)
    GetKeyContainer.Size = UDim2.new(0, 145, 0, 35)
    Instance.new("UICorner", GetKeyContainer).CornerRadius = UDim.new(0, 6)

    GetKeyButton.Name = "GetKeyButton"
    GetKeyButton.Parent = GetKeyContainer
    GetKeyButton.BackgroundTransparency = 1.000
    GetKeyButton.Size = UDim2.new(1, 0, 1, 0)
    GetKeyButton.Font = Enum.Font.SourceSansBold
    GetKeyButton.Text = "GET KEY"
    GetKeyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    GetKeyButton.TextSize = 16

    RedeemContainer.Name = "RedeemContainer"
    RedeemContainer.Parent = MainFrame
    RedeemContainer.BackgroundColor3 = Color3.fromRGB(0, 140, 255)
    RedeemContainer.Position = UDim2.new(0.53, 0, 0.7, 0)
    RedeemContainer.Size = UDim2.new(0, 145, 0, 35)
    Instance.new("UICorner", RedeemContainer).CornerRadius = UDim.new(0, 6)

    RedeemButton.Name = "RedeemButton"
    RedeemButton.Parent = RedeemContainer
    RedeemButton.BackgroundTransparency = 1.000
    RedeemButton.Size = UDim2.new(1, 0, 1, 0)
    RedeemButton.Font = Enum.Font.SourceSansBold
    RedeemButton.Text = "VERIFY"
    RedeemButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    RedeemButton.TextSize = 16

    -- // Get Key Button logic
    GetKeyButton.MouseButton1Click:Connect(function()
        local link = Pelinda.GetKeyLink({ Service = __PELINDA_SERVICE__ })
        setclipboard(link)
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "PUNK X HUB",
            Text = "Key link copied!",
            Duration = 3
        })
    end)

    -- // Verify Button logic
    RedeemButton.MouseButton1Click:Connect(function()
        local inputKey = KeyTextBox.Text
        local status = Pelinda.Init({
            Service = __PELINDA_SERVICE__,
            SilentMode = __PELINDA_SILENTMODE__,
            Key = inputKey,
            SecurityLevel = __PELINDA_SECURITY_LEVEL__
        })

        if status == "validated!!" then
            writefile("punkx_v3_key.txt", inputKey)
            ScreenGui:Destroy()
            LoadHub()
        else
            KeyTextBox.Text = ""
            KeyTextBox.PlaceholderText = "Invalid Key!"
            task.wait(1.5)
            KeyTextBox.PlaceholderText = "Input Key..."
        end
    end)
end

-- [[ AUTO-CHECK ON BOOT ]]
task.spawn(function()
    pcall(function()
        local fileName = "punkx_v3_key.txt"
        if isfile(fileName) then
            local KeyFound = readfile(fileName):gsub("%s+", "")
            if KeyFound ~= "" then
                print("Validating your key...")
                local validated = false
                for attempt = 1, 3 do
                    local ok, result = pcall(function()
                        return Pelinda.Init({
                            Service = __PELINDA_SERVICE__,
                            SilentMode = __PELINDA_SILENTMODE__,
                            Key = KeyFound,
                            SecurityLevel = __PELINDA_SECURITY_LEVEL__
                        })
                    end)
                    if ok and result == "validated!!" then
                        validated = true
                        break
                    end
                    task.wait(.5)
                end
                
                if validated then
                    LoadHub()
                else
                    print("Expired or Invalid Key")
                    ShowKeySystem()
                end
            else
                ShowKeySystem()
            end
        else
            ShowKeySystem()
        end
    end)
end)
