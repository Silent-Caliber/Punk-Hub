-- Gui to Lua - Version: 3.2
local __PELINDA_SERVICE__ = "punk-x-release-key"
local __PELINDA_SILENTMODE__ = true
local __PELINDA_SECURITY_LEVEL__ = 1 
local PUNK_HUB_URL = "https://raw.githubusercontent.com/GBMofo/Game-Hub/main/Punk-Team"

-- [[ SAFE HUB EXECUTION ]]
local function LoadHub()
    print("Punk X: Fetching Hub...")
    
    -- Using pcall to prevent the entire script from breaking on a bad URL
    local success, content = pcall(function()
        return game:HttpGet(PUNK_HUB_URL)
    end)

    if success and content then
        -- Verify it's not a GitHub 404 page
        if content:find("404: Not Found") or content:find("<!DOCTYPE html>") then
            warn("Punk X: Error 404 - The GitHub link is broken or the file 'The-Forge' doesn't exist.")
            return
        end

        -- Load the string safely
        local func, err = loadstring(content)
        if func then
            print("Punk X: Hub Loaded Successfully!")
            func() -- Execute the hub
        else
            warn("Punk X: Script Error - The code on GitHub has a syntax error: " .. tostring(err))
        end
    else
        warn("Punk X: Failed to connect to GitHub. Please check your internet or the link.")
    end
end

function ShowKeySystem()
    -- Draggable logic
    local function MakeDraggable(gui)
        local dragging, dragInput, dragStart, startPos
        gui.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                dragging = true; dragStart = input.Position; startPos = gui.Position
                input.Changed:Connect(function()
                    if input.UserInputState == Enum.UserInputState.End then dragging = false end
                end)
            end
        end)
        game:GetService("UserInputService").InputChanged:Connect(function(input)
            if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                local delta = input.Position - dragStart
                gui.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            end
        end)
    end

    local ScreenGui = Instance.new("ScreenGui")
    local MainFrame = Instance.new("Frame")
    local NamaHub = Instance.new("TextLabel")
    local KeyTextBox = Instance.new("TextBox")
    local GetKeyButton = Instance.new("TextButton")
    local RedeemButton = Instance.new("TextButton")

    ScreenGui.Parent = (game:GetService("CoreGui") or game:GetService("Players").LocalPlayer.PlayerGui)
    
    MainFrame.Size = UDim2.new(0, 350, 0, 180)
    MainFrame.Position = UDim2.new(0.5, -175, 0.5, -90)
    MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    MainFrame.Parent = ScreenGui
    Instance.new("UICorner", MainFrame)
    MakeDraggable(MainFrame)

    NamaHub.Size = UDim2.new(1, 0, 0, 40)
    NamaHub.Text = "PUNK X KEY SYSTEM"
    NamaHub.TextColor3 = Color3.fromRGB(255, 255, 255)
    NamaHub.BackgroundTransparency = 1
    NamaHub.Font = Enum.Font.FredokaOne
    NamaHub.TextSize = 20
    NamaHub.Parent = MainFrame

    KeyTextBox.Size = UDim2.new(0.8, 0, 0, 35)
    KeyTextBox.Position = UDim2.new(0.1, 0, 0.35, 0)
    KeyTextBox.PlaceholderText = "Paste Key Here..."
    KeyTextBox.Text = ""
    KeyTextBox.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    KeyTextBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    KeyTextBox.Parent = MainFrame
    Instance.new("UICorner", KeyTextBox)

    GetKeyButton.Size = UDim2.new(0.38, 0, 0, 35)
    GetKeyButton.Position = UDim2.new(0.1, 0, 0.65, 0)
    GetKeyButton.Text = "GET KEY"
    GetKeyButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    GetKeyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    GetKeyButton.Parent = MainFrame
    Instance.new("UICorner", GetKeyButton)

    RedeemButton.Size = UDim2.new(0.38, 0, 0, 35)
    RedeemButton.Position = UDim2.new(0.52, 0, 0.65, 0)
    RedeemButton.Text = "VERIFY"
    RedeemButton.BackgroundColor3 = Color3.fromRGB(0, 120, 255)
    RedeemButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    RedeemButton.Parent = MainFrame
    Instance.new("UICorner", RedeemButton)

    GetKeyButton.MouseButton1Click:Connect(function()
        local link = Pelinda.GetKeyLink({ Service = __PELINDA_SERVICE__ })
        setclipboard(link)
        print("Link copied to clipboard")
    end)

    RedeemButton.MouseButton1Click:Connect(function()
        local input = KeyTextBox.Text
        local status = Pelinda.Init({
            Service = __PELINDA_SERVICE__,
            SilentMode = __PELINDA_SILENTMODE__,
            Key = input,
            SecurityLevel = __PELINDA_SECURITY_LEVEL__
        })

        if status == "validated!!" then
            writefile("punk_key.txt", input)
            ScreenGui:Destroy()
            LoadHub()
        else
            KeyTextBox.Text = ""
            KeyTextBox.PlaceholderText = "Invalid Key!"
        end
    end)
end

-- [[ AUTO LOGIN LOGIC ]]
task.spawn(function()
    local savedKey = isfile("punk_key.txt") and readfile("punk_key.txt"):gsub("%s+", "")
    if savedKey and savedKey ~= "" then
        local status = Pelinda.Init({
            Service = __PELINDA_SERVICE__,
            SilentMode = __PELINDA_SILENTMODE__,
            Key = savedKey,
            SecurityLevel = __PELINDA_SECURITY_LEVEL__
        })
        if status == "validated!!" then
            LoadHub()
        else
            ShowKeySystem()
        end
    else
        ShowKeySystem()
    end
end)
