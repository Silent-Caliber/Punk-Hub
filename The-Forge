repeat task.wait() until game:IsLoaded()

local AuthLibrary = nil 

local ServiceID = "punk-x-release-key" 

local ScriptLoader = 'loadstring(game:HttpGet("https://raw.githubusercontent.com/GBMofo/Punk-Hub/main/The-Forge"))()'

local function getSafeHWID()
    if gethwid then 
        return gethwid()
    elseif syn and syn.gethwid then
        return syn.gethwid()
    end
    return game:GetService("RbxAnalyticsService"):GetClientId()
end

function GetKeyLink(serviceId, hwid)
    return "https://pandadevelopment.net/getkey?service=" .. tostring(serviceId) .. "&hwid=" .. tostring(hwid)
end

local savedKeyPath = "Punkhub_Key.lua"
local Players = game:GetService("Players")
local StarterGui = game:GetService("StarterGui")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local function notif(text, title)
    StarterGui:SetCore("SendNotification", {
        Title = title or "Panda 3 / Punk X",
        Text = text or "",
        Duration = 5
    })
end

local gui = Instance.new("ScreenGui", playerGui)
gui.Name = "Panda3_PunkX_KeySystem"
gui.ResetOnSpawn = false
gui.IgnoreGuiInset = true

local main = Instance.new("Frame")
main.Size = UDim2.new(0, 360, 0, 190)
main.Position = UDim2.new(0.5, 0, 0.5, 0)
main.AnchorPoint = Vector2.new(0.5, 0.5)
main.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
main.BorderSizePixel = 0
main.Parent = gui
main.Active = true
main.Draggable = true
Instance.new("UICorner", main).CornerRadius = UDim.new(0, 12)

local title = Instance.new("TextLabel", main)
title.Size = UDim2.new(1, 0, 0, 30)
title.Position = UDim2.new(0, 0, 0, 10)
title.BackgroundTransparency = 1
title.Text = "PANDA 3 / PUNK X HUB"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 20

local closeBtn = Instance.new("TextButton", main)
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -40, 0, 5)
closeBtn.BackgroundTransparency = 1
closeBtn.Text = "X"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 16
local xGradient = Instance.new("UIGradient", closeBtn)
xGradient.Color = ColorSequence.new{
	ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 255, 255)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 20, 30))
}
xGradient.Rotation = 45
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.MouseButton1Click:Connect(function()
	gui:Destroy()
end)

local subtitle = Instance.new("TextLabel", main)
subtitle.Size = UDim2.new(1, 0, 0, 20)
subtitle.Position = UDim2.new(0, 0, 0, 40)
subtitle.BackgroundTransparency = 1
subtitle.Text = "Authentication via Panda Development"
subtitle.TextColor3 = Color3.fromRGB(170, 170, 170)
subtitle.Font = Enum.Font.Gotham
subtitle.TextSize = 14

local keyInput = Instance.new("TextBox", main)
keyInput.Size = UDim2.new(0.779, 0,0, 35)
keyInput.Position = UDim2.new(0.05, 0, 0, 75)
keyInput.PlaceholderText = "Paste Key Here..."
keyInput.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
keyInput.TextColor3 = Color3.fromRGB(255, 255, 255)
keyInput.Text = ""
keyInput.Font = Enum.Font.Gotham
keyInput.TextSize = 14
Instance.new("UICorner", keyInput).CornerRadius = UDim.new(0, 8)

local textboxIcon = Instance.new("ImageLabel", keyInput)
textboxIcon.Size = UDim2.new(0, 20, 0, 20)
textboxIcon.Position = UDim2.new(0, 5, 0.5, -10)
textboxIcon.BackgroundTransparency = 1
textboxIcon.Image = "rbxassetid://131556088905771"

local paste = Instance.new("TextButton", main)
paste.Size = UDim2.new(0.101111181, 0, 0, 35)
paste.Position = UDim2.new(0.849, 0,0, 75)
paste.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
paste.Text = " "
paste.TextColor3 = Color3.fromRGB(200, 200, 200)
paste.Font = Enum.Font.Gotham
paste.TextSize = 14
Instance.new("UICorner", paste).CornerRadius = UDim.new(0, 8)

local pasteIcon = Instance.new("ImageLabel", paste)
pasteIcon.Size = UDim2.new(0, 20, 0, 20)
pasteIcon.Position = UDim2.new(0.082802549, 5, 0.5, -10)
pasteIcon.BackgroundTransparency = 1
pasteIcon.Image = "rbxassetid://98074949340874"
pasteIcon.ImageColor3 = Color3.fromRGB(178, 178, 178)

local getKey = Instance.new("TextButton", main)
getKey.Size = UDim2.new(0.45, -5, 0, 40)
getKey.Position = UDim2.new(0.05, 0, 0, 140)
getKey.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
getKey.Text = "Get Key"
getKey.TextColor3 = Color3.fromRGB(255, 255, 255)
getKey.Font = Enum.Font.GothamBold
getKey.TextSize = 14
Instance.new("UICorner", getKey).CornerRadius = UDim.new(0, 8)

local getKeyIcon = Instance.new("ImageLabel", getKey)
getKeyIcon.Size = UDim2.new(0, 20, 0, 20)
getKeyIcon.Position = UDim2.new(0, 30, 0.5, -10)
getKeyIcon.BackgroundTransparency = 1
getKeyIcon.Image = "rbxassetid://85434572689388"

local verify = Instance.new("TextButton", main)
verify.Size = UDim2.new(0.45, -5, 0, 40)
verify.Position = UDim2.new(0.5, 5, 0, 140)
verify.BackgroundColor3 = Color3.fromRGB(100, 70, 255)
verify.Text = "Verify Key"
verify.TextColor3 = Color3.fromRGB(255, 255, 255)
verify.Font = Enum.Font.GothamBold
verify.TextSize = 14
Instance.new("UICorner", verify).CornerRadius = UDim.new(0, 8)

paste.MouseButton1Click:Connect(function()
	pcall(function()
		keyInput.Text = getclipboard()
	end)
end)

getKey.MouseButton1Click:Connect(function()
    if ServiceID == "ENTER_YOUR_SERVICE_ID_HERE" then
        notif("Configuration Error: Service ID not set in script!", "Error")
        return
    end

    local hwid = getSafeHWID()
    local link = GetKeyLink(ServiceID, hwid)
    
    setclipboard(link)
    
    notif("Panda key link copied to clipboard!", "Success")
    notif("Paste the link in your browser to get the key.", "Info")
end)

verify.MouseButton1Click:Connect(function()
	local enteredKey = keyInput.Text
	if enteredKey == "" then
		notif("Please enter a key.", "Error")
		return
	end
    
    local keyAccepted = false

    -- 1. If AuthLibrary is missing, accept keys that look like PunkX keys (Bypass)
    if not AuthLibrary then
        if enteredKey:sub(1, 6) == "PunkX-" and #enteredKey >= 30 then
            notif("Key format recognized. Loading script...", "Success")
            keyAccepted = true
        else
            -- AuthLibrary is nil AND key format is wrong
            notif("Error: Panda Auth Library is not configured. (Line 4)", "Error")
            warn("AuthLibrary is nil. Set the Panda Auth loadstring on line 4.")
            return
        end
    else
        -- 2. Check using Panda Auth Library
    	local status = AuthLibrary.check_key(enteredKey)
        
    	if status and (status.code == "KEY_VALID" or status == true) then
            keyAccepted = true
    	else
            local errorText = (type(status) == "table" and status.message) or "Invalid or Expired Key."
    		notif(errorText, "Error")
            return
    	end
    end

    if keyAccepted then
		notif("Key Valid! Access Granted. Loading script...", "Success")
		getgenv().script_key = tostring(enteredKey)
		
		writefile(savedKeyPath, enteredKey)
		
        loadstring(ScriptLoader)()
        
		gui:Destroy()
	end
end)

if isfile(savedKeyPath) and AuthLibrary then
	local savedKey = readfile(savedKeyPath)
    if savedKey and #savedKey > 0 then
        task.spawn(function()
            local status = AuthLibrary.check_key(savedKey)
            if status and (status.code == "KEY_VALID" or status == true) then
                getgenv().script_key = savedKey
                
                loadstring(ScriptLoader)()
                
                if gui and gui.Parent then 
                    gui:Destroy() 
                end
            end
        end)
    end
end    NamaHub.Name = "NamaHub"
    NamaHub.Parent = MainFrame
    NamaHub.BackgroundTransparency = 1.000
    NamaHub.Position = UDim2.new(0, 0, 0, 10)
    NamaHub.Size = UDim2.new(1, 0, 0, 30)
    NamaHub.Font = Enum.Font.FredokaOne
    NamaHub.Text = "PUNK X HUB"
    NamaHub.TextColor3 = Color3.fromRGB(255, 255, 255)
    NamaHub.TextSize = 26

    KeySystemLabel.Name = "KeySystemLabel"
    KeySystemLabel.Parent = MainFrame
    KeySystemLabel.BackgroundTransparency = 1.000
    KeySystemLabel.Position = UDim2.new(0, 0, 0.25, 0)
    KeySystemLabel.Size = UDim2.new(1, 0, 0, 20)
    KeySystemLabel.Font = Enum.Font.SourceSansBold
    KeySystemLabel.Text = "LICENSE VERIFICATION"
    KeySystemLabel.TextColor3 = Color3.fromRGB(0, 160, 255)
    KeySystemLabel.TextSize = 16

    TextBoxContainer.Name = "TextBoxContainer"
    TextBoxContainer.Parent = MainFrame
    TextBoxContainer.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    TextBoxContainer.Position = UDim2.new(0.1, 0, 0.45, 0)
    TextBoxContainer.Size = UDim2.new(0.8, 0, 0, 35)
    Instance.new("UICorner", TextBoxContainer).CornerRadius = UDim.new(0, 6)

    KeyTextBox.Name = "KeyTextBox"
    KeyTextBox.Parent = TextBoxContainer
    KeyTextBox.BackgroundTransparency = 1.000
    KeyTextBox.Position = UDim2.new(0.1, 0, 0, 0)
    KeyTextBox.Size = UDim2.new(0.85, 0, 1, 0)
    KeyTextBox.Font = Enum.Font.SourceSans
    KeyTextBox.PlaceholderText = "Input Key..."
    KeyTextBox.Text = ""
    KeyTextBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    KeyTextBox.TextSize = 16
    KeyTextBox.TextXAlignment = Enum.TextXAlignment.Left

    KunciIcon.Name = "KunciIcon"
    KunciIcon.Parent = TextBoxContainer
    KunciIcon.BackgroundTransparency = 1.000
    KunciIcon.Position = UDim2.new(0.02, 0, 0.15, 0)
    KunciIcon.Size = UDim2.new(0, 24, 0, 24)
    KunciIcon.Image = "rbxassetid://10723416652"

    GetKeyContainer.Name = "GetKeyContainer"
    GetKeyContainer.Parent = MainFrame
    GetKeyContainer.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    GetKeyContainer.Position = UDim2.new(0.1, 0, 0.7, 0)
    GetKeyContainer.Size = UDim2.new(0, 145, 0, 35)
    Instance.new("UICorner", GetKeyContainer).CornerRadius = UDim.new(0, 6)

    GetKeyButton.Name = "GetKeyButton"
    GetKeyButton.Parent = GetKeyContainer
    GetKeyButton.BackgroundTransparency = 1.000
    GetKeyButton.Size = UDim2.new(1, 0, 1, 0)
    GetKeyButton.Font = Enum.Font.SourceSansBold
    GetKeyButton.Text = "GET KEY"
    GetKeyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    GetKeyButton.TextSize = 16

    RedeemContainer.Name = "RedeemContainer"
    RedeemContainer.Parent = MainFrame
    RedeemContainer.BackgroundColor3 = Color3.fromRGB(0, 140, 255)
    RedeemContainer.Position = UDim2.new(0.53, 0, 0.7, 0)
    RedeemContainer.Size = UDim2.new(0, 145, 0, 35)
    Instance.new("UICorner", RedeemContainer).CornerRadius = UDim.new(0, 6)

    RedeemButton.Name = "RedeemButton"
    RedeemButton.Parent = RedeemContainer
    RedeemButton.BackgroundTransparency = 1.000
    RedeemButton.Size = UDim2.new(1, 0, 1, 0)
    RedeemButton.Font = Enum.Font.SourceSansBold
    RedeemButton.Text = "VERIFY"
    RedeemButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    RedeemButton.TextSize = 16

    -- // Get Key Button logic
    GetKeyButton.MouseButton1Click:Connect(function()
        local link = Pelinda.GetKeyLink({ Service = __PELINDA_SERVICE__ })
        setclipboard(link)
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "PUNK X HUB",
            Text = "Key link copied!",
            Duration = 3
        })
    end)

    -- // Verify Button logic
    RedeemButton.MouseButton1Click:Connect(function()
        local inputKey = KeyTextBox.Text
        local status = Pelinda.Init({
            Service = __PELINDA_SERVICE__,
            SilentMode = __PELINDA_SILENTMODE__,
            Key = inputKey,
            SecurityLevel = __PELINDA_SECURITY_LEVEL__
        })

        if status == "validated!!" then
            writefile("punkx_v3_key.txt", inputKey)
            ScreenGui:Destroy()
            LoadHub()
        else
            KeyTextBox.Text = ""
            KeyTextBox.PlaceholderText = "Invalid Key!"
            task.wait(1.5)
            KeyTextBox.PlaceholderText = "Input Key..."
        end
    end)
end

-- [[ AUTO-CHECK ON BOOT ]]
task.spawn(function()
    pcall(function()
        local fileName = "punkx_v3_key.txt"
        if isfile(fileName) then
            local KeyFound = readfile(fileName):gsub("%s+", "")
            if KeyFound ~= "" then
                print("Validating your key...")
                local validated = false
                for attempt = 1, 3 do
                    local ok, result = pcall(function()
                        return Pelinda.Init({
                            Service = __PELINDA_SERVICE__,
                            SilentMode = __PELINDA_SILENTMODE__,
                            Key = KeyFound,
                            SecurityLevel = __PELINDA_SECURITY_LEVEL__
                        })
                    end)
                    if ok and result == "validated!!" then
                        validated = true
                        break
                    end
                    task.wait(.5)
                end
                
                if validated then
                    LoadHub()
                else
                    print("Expired or Invalid Key")
                    ShowKeySystem()
                end
            else
                ShowKeySystem()
            end
        else
            ShowKeySystem()
        end
    end)
end)
